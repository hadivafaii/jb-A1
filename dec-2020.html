
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>December 2020 &#8212; A1 Tone Discrimination [CHRONOLOGICAL PROGRESS]</title>
    
  <link rel="stylesheet" href="_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.2d2078699c18a0efb88233928e1cf6ed.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.be0a4a0c39cd630af62a2fcf693f3f06.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Welcome" href="intro.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  <img src="_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">A1 Tone Discrimination [CHRONOLOGICAL PROGRESS]</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Welcome
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   December 2020
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/dec-2020.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/hadivafaii/A1ToneDiscrimination"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/hadivafaii/A1ToneDiscrimination/issues/new?title=Issue%20on%20page%20%2Fdec-2020.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/hadivafaii/A1ToneDiscrimination/master?urlpath=tree/docs/dec-2020.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dec-18">
   Dec/18
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualizing-trial-averages">
     Visualizing trial averages
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#confidence-interval-vs-standard-deviation">
       95% confidence interval vs. standard deviation
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#classification-on-a-bag-of-trajectories">
     Classification on a bag of trajectories
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#response-magnitude">
       Response magnitude:
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#what-if-we-just-used-exc-cells-only">
       What if we just used EXC cells only?
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="december-2020">
<h1>December 2020<a class="headerlink" href="#december-2020" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span> <span class="k">as</span> <span class="n">pjoin</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span> <span class="k">as</span> <span class="n">dc</span>
<span class="kn">from</span> <span class="nn">tqdm.notebook</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>

<span class="n">github_path</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span> <span class="s1">&#39;Dropbox/git/A1ToneDiscrimination/&#39;</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">github_path</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">utils.process</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">utils.plot_functions</span> <span class="kn">import</span> <span class="n">mk_pie_plot</span><span class="p">,</span> <span class="n">mk_data_summary_plot</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">base_dir</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;HOME&#39;</span><span class="p">],</span> <span class="s1">&#39;Documents/A1&#39;</span><span class="p">)</span>
<span class="n">data_dir</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;Data&#39;</span><span class="p">)</span>
<span class="n">results_dir</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;results&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nb_std</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">processed_dir</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="s1">&#39;python_processed&#39;</span><span class="p">)</span>
<span class="n">h_load_file</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span><span class="n">processed_dir</span><span class="p">,</span> <span class="s2">&quot;organized_nb_std=</span><span class="si">{:d}</span><span class="s2">.h5&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nb_std</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">load_df_file</span> <span class="o">=</span> <span class="n">pjoin</span><span class="p">(</span><span class="n">processed_dir</span><span class="p">,</span> <span class="s1">&#39;processed_nb_std=</span><span class="si">{:d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nb_std</span><span class="p">),</span> <span class="s2">&quot;all.df&quot;</span><span class="p">)</span>
<span class="n">df_all</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">load_df_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="dec-18">
<h2>Dec/18<a class="headerlink" href="#dec-18" title="Permalink to this headline">¶</a></h2>
<div class="section" id="visualizing-trial-averages">
<h3>Visualizing trial averages<a class="headerlink" href="#visualizing-trial-averages" title="Permalink to this headline">¶</a></h3>
<p>Here we plot average responses for a given trial type using all cells from all experiments. Passive trials also included.  Different behavior labels are define according to these frequencies:</p>
<ul class="simple">
<li><p>target: <span class="math notranslate nohighlight">\(7, 10\)</span> kHz
- For target frequencies, animals should start licking after <span class="math notranslate nohighlight">\(1s\)</span> of stimulus presentation (<span class="math notranslate nohighlight">\(t = 45\)</span>), because there will be a reward present.
- <strong>hit</strong>: if they lick
- <strong>miss</strong>: if they don’t lick</p></li>
<li><p>nontarget: <span class="math notranslate nohighlight">\(14, 20\)</span> kHz
- For nontarget frequencies, animals should not lickat all because they are trained to detect, and ignore these higher frequency stimuli. No reward will be presented during this trials.
- <strong>correcreject</strong>: if they don’t lick
- <strong>falsealarm</strong>: if they start licking (they’ll find no reward and just stop after few licks).</p></li>
</ul>
<p>Interestingly, at <span class="math notranslate nohighlight">\(f = 14\)</span> kHz avg traces for passive and falsealarm trials overlap almost perfectly.  Another interesting point is that during target frequencies, passive trials have larger amplitude compared to behavior trials.  Is this because these are not passive trials, and animals are actively listening with lots of focus, but they don’t lick because they know there are no rewards?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">behavior_freqs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">df_all</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_all</span><span class="o">.</span><span class="n">trial</span> <span class="o">!=</span> <span class="s1">&#39;passive&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">stimfreq</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;whitegrid&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax_arr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">freq</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">behavior_freqs</span><span class="p">):</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">idx</span> <span class="o">%</span> <span class="mi">2</span>
    
    <span class="k">if</span> <span class="n">freq</span> <span class="o">==</span> <span class="mi">7000</span><span class="p">:</span>
        <span class="n">freq_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">freq</span><span class="p">,</span> <span class="mi">7071</span><span class="p">]</span>
        <span class="n">trials_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hit&#39;</span><span class="p">,</span> <span class="s1">&#39;miss&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">freq</span> <span class="o">==</span> <span class="mi">9899</span><span class="p">:</span>
        <span class="n">freq_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">freq</span><span class="p">,</span> <span class="mi">10000</span><span class="p">]</span>
        <span class="n">trials_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hit&#39;</span><span class="p">,</span> <span class="s1">&#39;miss&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">freq</span> <span class="o">==</span> <span class="mi">14000</span><span class="p">:</span>
        <span class="n">freq_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">freq</span><span class="p">,</span> <span class="mi">14142</span><span class="p">]</span>
        <span class="n">trials_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;correctreject&#39;</span><span class="p">,</span> <span class="s1">&#39;falsealarm&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">freq</span> <span class="o">==</span> <span class="mi">19799</span><span class="p">:</span>
        <span class="n">freq_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">freq</span><span class="p">,</span> <span class="mi">20000</span><span class="p">]</span>
        <span class="n">trials_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;correctreject&#39;</span><span class="p">,</span> <span class="s1">&#39;falsealarm&#39;</span><span class="p">]</span>
    <span class="n">trials_list</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;passive&#39;</span><span class="p">])</span>
    
    <span class="n">selected_df</span> <span class="o">=</span> <span class="n">df_all</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df_all</span><span class="o">.</span><span class="n">stimfreq</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">freq_list</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_all</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">trials_list</span><span class="p">))]</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">selected_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;timepoint&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;dff&#39;</span><span class="p">,</span>
                 <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;trial&#39;</span><span class="p">,</span> <span class="n">hue_order</span><span class="o">=</span><span class="n">trials_list</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_arr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
    <span class="n">ax_arr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="c1"># get title</span>
    <span class="n">trial_counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">selected_df</span><span class="p">[</span><span class="n">selected_df</span><span class="o">.</span><span class="n">timepoint</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">trial</span><span class="p">)</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;f: </span><span class="si">{:.1f}</span><span class="s2"> kHz</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">freq</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">label_idx</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">trials_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">label_idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;# </span><span class="si">{:s}</span><span class="s2"> = </span><span class="si">{:d}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;,  # </span><span class="si">{:s}</span><span class="s2"> = </span><span class="si">{:d}</span><span class="s2">&quot;</span>
        <span class="n">values</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">item</span><span class="p">,</span> <span class="n">trial_counts</span><span class="p">[</span><span class="n">item</span><span class="p">]])</span>
    <span class="n">ax_arr</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">values</span><span class="p">))</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/dec-2020_7_0.png" src="_images/dec-2020_7_0.png" />
</div>
</div>
<div class="section" id="confidence-interval-vs-standard-deviation">
<h4>95% confidence interval vs. standard deviation<a class="headerlink" href="#confidence-interval-vs-standard-deviation" title="Permalink to this headline">¶</a></h4>
<p>All figures so far are showing mean and the shaded area is 95% CI.  I looked at the source code of the plotting package I’m using to make sure this is the case.  They bootstrap the data <em>then</em> computes the confidence interval on it.  This leads to a slightly better result, but at the end of the day it is showing 95% confidecne interval.</p>
<p>Now I will remake above plots, but this time contrasting 95% CI with just standard deviation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">output_trial</span><span class="p">,</span> <span class="n">output_freq</span> <span class="o">=</span> <span class="n">bag_of_trajectories</span><span class="p">(</span><span class="n">h_load_file</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 34/34 [00:01&lt;00:00, 25.40it/s]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">behavior_freqs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">df_all</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df_all</span><span class="o">.</span><span class="n">trial</span> <span class="o">!=</span> <span class="s1">&#39;passive&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">stimfreq</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;whitegrid&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax_arr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>

<span class="n">freq</span> <span class="o">=</span> <span class="mi">7000</span>
<span class="n">freq_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">freq</span><span class="p">,</span> <span class="mi">7071</span><span class="p">]</span>
<span class="n">trials_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hit&#39;</span><span class="p">,</span> <span class="s1">&#39;miss&#39;</span><span class="p">]</span>
<span class="n">selected_df</span> <span class="o">=</span> <span class="n">df_all</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">df_all</span><span class="o">.</span><span class="n">stimfreq</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">freq_list</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_all</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">trials_list</span><span class="p">))]</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">selected_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;timepoint&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;dff&#39;</span><span class="p">,</span>
             <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;trial&#39;</span><span class="p">,</span> <span class="n">hue_order</span><span class="o">=</span><span class="n">trials_list</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="n">trials_list</span><span class="p">:</span>
    <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;cyan&#39;</span> <span class="k">if</span> <span class="n">trial</span> <span class="o">==</span> <span class="s1">&#39;hit&#39;</span> <span class="k">else</span> <span class="s1">&#39;red&#39;</span>
    <span class="n">idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">output_trial</span><span class="p">[</span><span class="s1">&#39;df&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">trial</span> <span class="o">==</span> <span class="n">trial</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">output_trial</span><span class="p">[</span><span class="s1">&#39;dff&#39;</span><span class="p">][</span><span class="n">idxs</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">output_trial</span><span class="p">[</span><span class="s1">&#39;dff&#39;</span><span class="p">][</span><span class="n">idxs</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">nt</span><span class="p">),</span> <span class="n">mean</span><span class="o">-</span><span class="n">std</span><span class="p">,</span> <span class="n">mean</span><span class="o">+</span><span class="n">std</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>


<span class="c1"># get title</span>
<span class="n">trial_counts</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">selected_df</span><span class="p">[</span><span class="n">selected_df</span><span class="o">.</span><span class="n">timepoint</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">trial</span><span class="p">)</span>
<span class="n">msg1</span> <span class="o">=</span> <span class="s2">&quot;f: </span><span class="si">{:.1f}</span><span class="s2"> kHz (shaded area: confidecne interval) </span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="n">msg2</span> <span class="o">=</span> <span class="s2">&quot;f: </span><span class="si">{:.1f}</span><span class="s2"> kHz (shaded area: standard deviation) </span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">freq</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">]</span>
<span class="k">for</span> <span class="n">label_idx</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">trials_list</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">label_idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">msg1</span> <span class="o">+=</span> <span class="s2">&quot;# </span><span class="si">{:s}</span><span class="s2"> = </span><span class="si">{:d}</span><span class="s2">&quot;</span>
        <span class="n">msg2</span> <span class="o">+=</span> <span class="s2">&quot;# </span><span class="si">{:s}</span><span class="s2"> = </span><span class="si">{:d}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">msg1</span> <span class="o">+=</span> <span class="s2">&quot;,  # </span><span class="si">{:s}</span><span class="s2"> = </span><span class="si">{:d}</span><span class="s2">&quot;</span>
        <span class="n">msg2</span> <span class="o">+=</span> <span class="s2">&quot;,  # </span><span class="si">{:s}</span><span class="s2"> = </span><span class="si">{:d}</span><span class="s2">&quot;</span>
    <span class="n">values</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">item</span><span class="p">,</span> <span class="n">trial_counts</span><span class="p">[</span><span class="n">item</span><span class="p">]])</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">msg1</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">values</span><span class="p">))</span>
<span class="n">ax_arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">msg2</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">values</span><span class="p">))</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/dec-2020_10_0.png" src="_images/dec-2020_10_0.png" />
</div>
</div>
</div>
</div>
<div class="section" id="classification-on-a-bag-of-trajectories">
<h3>Classification on a bag of trajectories<a class="headerlink" href="#classification-on-a-bag-of-trajectories" title="Permalink to this headline">¶</a></h3>
<p>Let us take all the trajectories recorded from neurons.  A given trajectory is either:</p>
<ol class="simple">
<li><p><em>EXC</em>: maximum absolute intensity of the reponses is positive (the cell was excited)<br></p></li>
<li><p><em>SUP</em>: maximum absolute intensity of the reponses is negative (the cell was inhibited)</p></li>
</ol>
<p>These trajectories come from different trial types.  Here we focus only on <strong>hit</strong> and <strong>miss</strong> trials. We would like to learn a classifier that maps each trajectory to the trial label that it originates from.  We can take the entire trajectory and feed it into classifier, but first we define a simple scalar measure and use that.</p>
<div class="section" id="response-magnitude">
<h4>Response magnitude:<a class="headerlink" href="#response-magnitude" title="Permalink to this headline">¶</a></h4>
<p>Defined as the mean of trajectory values during times <span class="math notranslate nohighlight">\(t \in [40, 45)\)</span>.  This is the last third of listening period <span class="math notranslate nohighlight">\(t \in [30, 45)\)</span>, right before licking time onset <span class="math notranslate nohighlight">\(t = 45\)</span>. We take each trajectory, compute response magnitude, and try to predict trial type label from this scalar.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">trange</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">45</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">output_trial</span><span class="p">[</span><span class="s1">&#39;dff&#39;</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">output_trial</span><span class="p">[</span><span class="s1">&#39;df&#39;</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="n">hit_or_miss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">trial</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;hit&#39;</span><span class="p">,</span> <span class="s1">&#39;miss&#39;</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">hit_or_miss</span><span class="p">]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">hit_or_miss</span><span class="p">]</span>

<span class="n">tags</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">max_act</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
    <span class="n">_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">trange</span><span class="p">],</span> <span class="n">key</span><span class="o">=</span><span class="nb">abs</span><span class="p">)</span>
    <span class="n">_tag</span> <span class="o">=</span> <span class="s1">&#39;SUP&#39;</span> <span class="k">if</span> <span class="n">_val</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;EXC&#39;</span>
    <span class="n">max_act</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_val</span><span class="p">)</span>
    <span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_tag</span><span class="p">)</span>

<span class="n">mag</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="n">trange</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">output_trial</span><span class="p">[</span><span class="s1">&#39;str2int&#39;</span><span class="p">][</span><span class="n">item</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">])</span>

<span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">labels</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">mag</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>((94367, 135), (94367,), (94367, 1), (94367,))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tst_indxs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">trn_indxs</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;hit&#39;</span><span class="p">,</span> <span class="s1">&#39;miss&#39;</span><span class="p">]:</span>
    <span class="n">indxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">labels</span> <span class="o">==</span> <span class="n">trial</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">tst_indxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indxs</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">indxs</span><span class="p">)</span><span class="o">//</span><span class="mi">5</span><span class="p">])</span>
    <span class="n">trn_indxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indxs</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">indxs</span><span class="p">)</span><span class="o">//</span><span class="mi">5</span><span class="p">:])</span>

<span class="n">tst_indxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">tst_indxs</span><span class="p">)</span>
<span class="n">trn_indxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">trn_indxs</span><span class="p">)</span>

<span class="k">assert</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">tst_indxs</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">trn_indxs</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>

<span class="n">trange</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">45</span><span class="p">)</span>
<span class="n">clf</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span>
    <span class="c1"># penalty=&#39;l2&#39;,</span>
    <span class="c1"># C=0.1,</span>
    <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span>
    <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">class_weight</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">mag</span><span class="p">[</span><span class="n">trn_indxs</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">trn_indxs</span><span class="p">])</span>


<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">balanced_accuracy_score</span>

<span class="n">y_pred</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">mag</span><span class="p">[</span><span class="n">tst_indxs</span><span class="p">])</span>
<span class="n">balanced_accuracy_score</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">tst_indxs</span><span class="p">],</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.548780148609187
</pre></div>
</div>
</div>
</div>
<p>Classifier performance: 54 %, barely above chance</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;response_mag&#39;</span><span class="p">:</span> <span class="n">mag</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="s1">&#39;trial&#39;</span><span class="p">:</span> <span class="n">labels</span><span class="p">}</span>
<span class="n">tmp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">tmp_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;response_mag&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;trial&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">mag</span><span class="p">[</span><span class="n">labels</span> <span class="o">==</span> <span class="s1">&#39;hit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">mag</span><span class="p">[</span><span class="n">labels</span> <span class="o">==</span> <span class="s1">&#39;miss&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="mi">120</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/dec-2020_16_0.png" src="_images/dec-2020_16_0.png" />
</div>
</div>
</div>
<div class="section" id="what-if-we-just-used-exc-cells-only">
<h4>What if we just used EXC cells only?<a class="headerlink" href="#what-if-we-just-used-exc-cells-only" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sup_indxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;SUP&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">x_exc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sup_indxs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">labels_exc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">sup_indxs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">mag_exc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">mag</span><span class="p">,</span> <span class="n">sup_indxs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">y_exc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">output_trial</span><span class="p">[</span><span class="s1">&#39;str2int&#39;</span><span class="p">][</span><span class="n">item</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">labels_exc</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tst_indxs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">trn_indxs</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;hit&#39;</span><span class="p">,</span> <span class="s1">&#39;miss&#39;</span><span class="p">]:</span>
    <span class="n">indxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">labels_exc</span> <span class="o">==</span> <span class="n">trial</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">tst_indxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indxs</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">indxs</span><span class="p">)</span><span class="o">//</span><span class="mi">5</span><span class="p">])</span>
    <span class="n">trn_indxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indxs</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">indxs</span><span class="p">)</span><span class="o">//</span><span class="mi">5</span><span class="p">:])</span>

<span class="n">tst_indxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">tst_indxs</span><span class="p">)</span>
<span class="n">trn_indxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">trn_indxs</span><span class="p">)</span>

<span class="k">assert</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">tst_indxs</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">trn_indxs</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>

<span class="n">clf</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span>
    <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;lbfgs&#39;</span><span class="p">,</span>
    <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">class_weight</span><span class="o">=</span><span class="s1">&#39;balanced&#39;</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">mag</span><span class="p">[</span><span class="n">trn_indxs</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">trn_indxs</span><span class="p">])</span>


<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">balanced_accuracy_score</span>

<span class="n">y_pred</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">mag_exc</span><span class="p">[</span><span class="n">tst_indxs</span><span class="p">])</span>
<span class="n">balanced_accuracy_score</span><span class="p">(</span><span class="n">y_exc</span><span class="p">[</span><span class="n">tst_indxs</span><span class="p">],</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.5246829697902216
</pre></div>
</div>
</div>
</div>
<p>Classifier performance: 52 %, again chance level</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;response_mag&#39;</span><span class="p">:</span> <span class="n">mag_exc</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="s1">&#39;trial&#39;</span><span class="p">:</span> <span class="n">labels_exc</span><span class="p">}</span>
<span class="n">tmp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">data_dict</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">tmp_df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;response_mag&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;trial&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">mag</span><span class="p">[</span><span class="n">labels</span> <span class="o">==</span> <span class="s1">&#39;hit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">mag</span><span class="p">[</span><span class="n">labels</span> <span class="o">==</span> <span class="s1">&#39;miss&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/dec-2020_22_0.png" src="_images/dec-2020_22_0.png" />
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="intro.html" title="previous page">Welcome</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Hadi Vafaii<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>